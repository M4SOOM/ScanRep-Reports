name: Microsoft Security DevOps

on:
  workflow_call:

jobs:
  security-scan:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      security-events: write
      actions: read
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Run Microsoft Security DevOps
        uses: microsoft/security-devops-action@v1
        id: msdo
        continue-on-error: true
        with:
          # A comprehensive list of best-in-class security tools:
          # 1. bandit: Python SAST (finds os.system calls)
          # 2. binskim: Scans binary files for vulnerabilities
          # 3. checkov: Infrastructure-as-Code (IaC) scanner (Terraform/Docker)
          # 4. eslint: JavaScript/TypeScript security patterns
          # 5. terrascan: Multi-cloud IaC security (AWS/Azure/GCP)
          # 6. trivy: Container and Dependency vulnerability scanner
          # 7. templateanalyzer: Deep scan for ARM/Bicep templates
          # 8. antimalware: Scans build artifacts for viruses
          tools: bandit,binskim,checkov,eslint,terrascan,trivy,templateanalyzer,antimalware

      - name: Upload results to GitHub
        uses: github/codeql-action/upload-sarif@v4
        if: always() 
        with:
          sarif_file: ${{ steps.msdo.outputs.sarifFile }}
